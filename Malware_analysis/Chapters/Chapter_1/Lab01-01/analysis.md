### Lab 1 - 1

This lab uses the files Lab01-01.exe and Lab01-01.dll. Use the tools and techniques described in the chapter to gain information about the files and
answer the questions below.

Questions:
**1]** Upload the files to http://www.VirusTotal.com/ and view the reports. Does either file match any existing antivirus signatures?

Solution:  At the time of writing this solution,
*	41/67 AVs detected Lab01-01.exe as malicious.
*	30/66 AVs detected Lab01-01.dll as malicious. 
 
**2]** When were these files compiled?
Solution:
	Lab01-01.dll   : Created on 2010-12-19 16:16:38
	Lab01-01.exe : Created on 2010-12-19 16:16:19
	
One thing to note is, this creation time and date can be changed easily so that it represents some fake time and date.

**3]** Are there any indications that either of these files is packed or obfuscated?
If so, what are these indicators?
Solution: Both the files shows no signs of obfuscation.

**4]** Do any imports hint at what this malware does? If so, which imports
are they?
Solution:
Analyzing Lab01-01.exe using dependency walker, there are many file manipulation functions imported. The ones which felt important are

*	**CreateFileA** : Usage of this function suggests that a file might get  created when this executable is run.
*	**FindFirstFileA** and **FindNextFileA** : Usage of these suggest that the malware is searching for a particular file somewhere. 
*	**MapViewOfFile** : Usage of this functions means, a file is loaded into the memory and some manipulation is done to that file.

Analyzing the  DLLs used  by Lab01-01.dll, we get to know a lot about the malware's functionality.

* **WS2_32.dll** : This DLL has all the functions which will enable network communication. Functions like CreateSocket, recv, send etc., are present in this DLL.
This presence of this DLL means the malware has some network functionality.

**5]** Are there any other files or host-based indicators that you could look for on infected systems?
Solution: 
While analyzing the strings present in the Lab01-01.exe, I found an interesting string, mostly a filename.

* **kerne132.dll** : This seems like the DLL **kernel32.dll** but the difference is that 1 and l. So, kernel132.dll looks like the legit dll but it's not.
	 
 **6]** What network-based indicators could be used to find this malware on infected machines?
Solution: 
 While analyzing the strings present in Lab01-01.dll, I got an IP Address.
 **127.26.152.13** : The malware could be communicating with this IP Address. This IP Address can be used as a network-indicator.

**7]** What would you guess is the purpose of these files?
Solution: Looking at the above analysis, this could be a downloader or a Backdoor.

**Detailed Analysis** :

**Lab01-01.exe**
1. Output of VirusTotal.com: 
 VirusTotal gives a lot of details about the file uploaded.
Lab01-01.exe:  	

	*	41/67 AVs detected this image to be malicious. Most of them classified it in a generic manner as a generic Trojan. Only on AV classified it as a Downloader.

2. Imports from **KERNEL32.dll** :
	
	* CloseHandle
	*	UnmapViewOfFile
	*	IsBadReadPtr
	*	MapViewOfFile
	*	CreateFileMappingA
	*	CreateFileA
	*	FindClose
	*	FindNextFileA
	*	FindFirstFileA
	*	CopyFileA
	
3. Strings present in the image:
	
	* kerne132.dll
	*	kernel32.dll
	*	C:\*
	*	C:\windows\system32\kerne132.dll
	*	Lab01-01.dll
	*	C:\Windows\System32\Kernel32.dll
	*	WARNING_THIS_WILL_DESTROY_YOUR_MACHINE
	
	and many more. But we can conclude something solid about the malware using these strings.

**Lab01-01.dll**

1. Output of VirusTotal.com:

	*	30/66 AVs detected this DLL to be generic malicious Trojan. A few AVs classified it as Adware.

2. Imports from **KERNEL32.dll** :
	
	* OpenMutexA
	* CreateMutexA
	* Sleep
	* Closehandle
	* CreateProcessA
	
3. Imports from **WS2_32.dll** :

	* socket
	* closesocket
	* inet_addr
	* send
	* WSACleanup
	* WSAStartup
	* connect
	* shutdown
	* htons
	* recv

**NOTE** : VirusTotal gives a lot of details about the file uploaded. In the details section, it shows all the function imported from various DLLs,whether the image/dll is packed or not and more. So, using VirusTotal details in combination with the tools mentioned will save time in analysis.

**Connecting the dots and Hypothesis**

1. Functions imported by Lab01-01.exe. It uses FindFirstFile, FindNextFile, FindClose which are functions used to search a particular file. Looking at the expression **C:\\***, i am guessing this is the place where the searching for the file takes place. I am not sure which file is being searched.

2. The fake **kerne132.dll** : The Lab01-01.exe file uses **CreateFile** function. It can be concluded that it creates a file. I am guessing a file named kerne132.dll is created. The DLL is named so, (the 1 and l) because for a common man who is not so observant, he/she thinks that this is a legit DLL ,but it is not.
	**C:\windows\system32\kerne132.dll** could be the file created.
3. There is a string **Lab01-01.dll** . I am guessing that this DLL is the kerne132.dll.Because the function **CopyFile** is being used, the Lab01-01.dll is being copied into the kernel132.dll file.  So, the Lab01-01.exe is present to install/create and load this  malicious DLL into the victim machine.
4. The Lab01-01.exe has made use of **File Mapping** functions(Functions used to load a file on the disk to the main memory and manipulate them). So, my guess is , they map a file onto the main memory, they make the changes required and save it back on the disk. Looking at the strings used, the important dll, **C:\Windows\System32\Kernel32.dll** might get changed.
5. One more small thing. There is this string **WARNING_THIS_WILL_DESTROY_YOUR_MACHINE**. When I ran the Lab01-01.exe, this string gets printed on the console which appears for a moment and gets closed. 

All this can be concluded from static analysis of Lab01-01.exe. But the core stuff is related to Lab01-01.dll.

6. Lab01-01.dll imports the **CreateProcess** function. It means, once the DLL is run, it launches a process. I am guessing **this** new process is the process which is going to be a backdoor or downloader  and not the Lab01-01.exe.

7. The DLL imports **WS2_32.dll**. It has imported all the basic network functions. The new process launched by this DLL maybe makes use of these functions to contact the IP Address **127.26.152.13** .
8. I was not able to find the port number of that remote machine the victim machine is getting connected to.

And I find no specific signs of it particularly being a backdoor because, though there is an IP Address, there is no other evidence like importing shell32.dll which is common in a backdoor . 

It is also mostly not a Keylogger because this has not made use any **Hook** functions. 

These are the conclusions drawn from the basic static analysis done.

More evidence for/against this hypothesis and more conclusive proofs will be put up once the files are disassembled and seen.
